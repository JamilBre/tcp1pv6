<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador TCP - Encriptación César</title>
    <!-- React y ReactDOM desde CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel para compilar JSX en el navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS para estilos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        body {
            background-color: #f3f4f6;
        }
        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Componentes de Iconos
        const MonitorIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#3b82f6" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="14" x="2" y="3" rx="2"/><line x1="8" x2="16" y1="21" y2="21"/><line x1="12" x2="12" y1="17" y2="21"/></svg>
        );

        const ServerIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#1f2937" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/><line x1="10" x2="10.01" y1="6" y2="6"/><line x1="10" x2="10.01" y1="18" y2="18"/></svg>
        );

        const PlayIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
        );

        const RotateIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
        );

        const Node = ({ icon, label, ip }) => (
            <div className="flex flex-col items-center w-48 glass p-3 rounded-xl shadow-sm border border-gray-200">
                <div className="mb-2">{icon}</div>
                <div className="font-mono font-bold text-gray-800 text-[9px] sm:text-[10px] text-center break-all leading-tight">
                    {ip}
                </div>
                <div className="text-[10px] text-blue-600 font-bold uppercase tracking-widest mt-2">{label}</div>
            </div>
        );

        const PacketArrow = ({ packet, startX, endX }) => {
            const startPos = parseFloat(startX);
            const endPos = parseFloat(endX);
            const midPos = (startPos + endPos) / 2;
            
            return (
                <div className="w-full relative py-2 animate-fade-in">
                    {/* Header Table (PCAP Style) */}
                    <div 
                        className="absolute -top-16 bg-white border border-gray-400 text-[9px] z-20 shadow-lg"
                        style={{ 
                            width: '210px', 
                            left: `${midPos}%`, 
                            transform: 'translateX(-50%)' 
                        }}
                    >
                        <div className="grid grid-cols-2 border-b border-gray-300 bg-gray-50 font-bold text-gray-600 text-center uppercase tracking-tighter">
                            <div className="p-1 border-r border-gray-300">IPv6 Orig</div>
                            <div className="p-1">IPv6 Dest</div>
                        </div>
                        <div className="grid grid-cols-2 border-b border-gray-300 text-center font-mono leading-none py-1">
                            <div className="p-1 border-r border-gray-300 break-all px-2" title={packet.ipOrig}>{packet.ipOrig}</div>
                            <div className="p-1 break-all px-2" title={packet.ipDest}>{packet.ipDest}</div>
                        </div>
                        <div className="grid grid-cols-2 border-b border-gray-300 bg-gray-50 font-bold text-gray-600 text-center uppercase tracking-tighter">
                            <div className="p-1 border-r border-gray-300">TCP Ports</div>
                            <div className="p-1">TCP Control</div>
                        </div>
                        <div className="grid grid-cols-2 border-b border-gray-300 text-center font-mono">
                            <div className="p-1 border-r border-gray-300">{packet.portOrig} → {packet.portDest}</div>
                            <div className="p-1">PSH, ACK</div>
                        </div>
                        <div className={`p-2 text-center font-bold border-t-2 ${packet.type === 'request' ? 'text-gray-700' : 'text-green-600'} bg-white`}>
                            Payload: <span className="font-mono">"{packet.message}"</span>
                            {packet.type === 'response' && <div className="text-[8px] text-gray-400 mt-1 uppercase">Cifrado César (+3)</div>}
                        </div>
                    </div>

                    <svg className="w-full h-12 overflow-visible">
                        <defs>
                            <marker
                                id={`arrowhead-${packet.id}`}
                                markerWidth="10"
                                markerHeight="7"
                                refX="9"
                                refY="3.5"
                                orient="auto"
                            >
                                <polygon points="0 0, 10 3.5, 0 7" fill="#64748b" />
                            </marker>
                        </defs>
                        <line
                            x1={`${startX}`}
                            y1="10"
                            x2={`${endX}`}
                            y2="30"
                            stroke="#64748b"
                            strokeWidth="2"
                            strokeDasharray={packet.type === 'response' ? "4" : "0"}
                            markerEnd={`url(#arrowhead-${packet.id})`}
                        />
                    </svg>
                </div>
            );
        };

        const App = () => {
            const [visiblePackets, setVisiblePackets] = useState([]);
            const [isPlaying, setIsPlaying] = useState(false);

            // Direcciones IPv6 Completas extraídas/calculadas del archivo pcap
            const serverIP = "fd00::ea9c:25ff:fe80:bd0b";
            const client1IP = "fd00::ce28:aaff:fe28:aa01"; // Basado en MAC cc:28:aa
            const client2IP = "fd00::39bb:deff:fe3b:9bde"; // Basado en MAC 3b:bb:de

            const packets = [
                { id: 1, from: 'client1', to: 'server', ipOrig: client1IP, ipDest: serverIP, portOrig: '49512', portDest: '8080', message: 'holacomoestas', type: 'request' },
                { id: 2, from: 'server', to: 'client1', ipOrig: serverIP, ipDest: client1IP, portOrig: '8080', portDest: '49512', message: 'krodfrprhvwdv', type: 'response' },
                { id: 3, from: 'client2', to: 'server', ipOrig: client2IP, ipDest: serverIP, portOrig: '55231', portDest: '8080', message: 'bien_gracias', type: 'request' },
                { id: 4, from: 'server', to: 'client2', ipOrig: serverIP, ipDest: client2IP, portOrig: '8080', portDest: '55231', message: 'elhqbjudfldv', type: 'response' }
            ];

            useEffect(() => {
                let interval;
                if (isPlaying && visiblePackets.length < packets.length) {
                    interval = setInterval(() => {
                        setVisiblePackets((prev) => [...prev, packets[prev.length]]);
                    }, 2200);
                } else if (visiblePackets.length === packets.length) {
                    setIsPlaying(false);
                }
                return () => clearInterval(interval);
            }, [isPlaying, visiblePackets]);

            const reset = () => {
                setVisiblePackets([]);
                setIsPlaying(false);
            };

            const getXPosition = (node) => {
                if (node === 'client1') return '15%';
                if (node === 'server') return '50%';
                if (node === 'client2') return '85%';
                return '0%';
            };

            return (
                <div className="flex flex-col items-center justify-start min-h-screen p-4 md:p-8 font-sans">
                    <div className="max-w-6xl w-full bg-white rounded-2xl shadow-2xl p-8 border border-gray-100 relative overflow-hidden">
                        
                        {/* Header decorativo */}
                        <div className="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500"></div>

                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center mb-16 gap-4">
                            <div>
                                <h1 className="text-3xl font-extrabold text-gray-900 tracking-tight">Análisis de Tráfico <span className="text-blue-600">IPv6 Full Stack</span></h1>
                                <p className="text-sm text-gray-500 font-mono mt-1 uppercase tracking-wider">Flujo detectado en: TCPencriptacion.pcapng</p>
                            </div>
                            <div className="flex gap-3">
                                <button 
                                    onClick={() => setIsPlaying(true)}
                                    disabled={isPlaying || visiblePackets.length === packets.length}
                                    className="flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2.5 rounded-xl transition-all disabled:opacity-50 font-bold shadow-lg shadow-indigo-100 active:scale-95"
                                >
                                    <PlayIcon /> Simular Transmisión
                                </button>
                                <button 
                                    onClick={reset}
                                    className="flex items-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 px-6 py-2.5 rounded-xl transition-all font-bold active:scale-95 border border-gray-200"
                                >
                                    <RotateIcon /> Reiniciar
                                </button>
                            </div>
                        </div>

                        {/* Diagrama de Secuencia */}
                        <div className="relative min-h-[900px] w-full border-x border-dashed border-gray-200 pt-36 pb-20 rounded-lg bg-gray-50/20">
                            
                            {/* Etiquetas de Nodos */}
                            <div className="flex justify-between items-start absolute top-6 left-0 w-full px-4 z-30">
                                <div style={{left: '15%', transform: 'translateX(-50%)'}} className="absolute">
                                    <Node icon={<MonitorIcon />} label="Cliente 1" ip={client1IP} />
                                </div>
                                <div style={{left: '50%', transform: 'translateX(-50%)'}} className="absolute">
                                    <Node icon={<ServerIcon />} label="Servidor" ip={serverIP} />
                                </div>
                                <div style={{left: '85%', transform: 'translateX(-50%)'}} className="absolute">
                                    <Node icon={<MonitorIcon />} label="Cliente 2" ip={client2IP} />
                                </div>
                            </div>

                            {/* Líneas de vida (Lifelines) */}
                            <div className="absolute top-10 bottom-0 left-[15%] w-[2px] bg-gradient-to-b from-blue-200 to-transparent"></div>
                            <div className="absolute top-10 bottom-0 left-[50%] w-[2px] bg-gradient-to-b from-gray-300 to-transparent"></div>
                            <div className="absolute top-10 bottom-0 left-[85%] w-[2px] bg-gradient-to-b from-blue-200 to-transparent"></div>

                            {/* Mensajes en tránsito */}
                            <div className="mt-40 space-y-48 flex flex-col items-center relative z-10">
                                {visiblePackets.map((pkt) => (
                                    <PacketArrow 
                                        key={pkt.id} 
                                        packet={pkt} 
                                        startX={getXPosition(pkt.from)} 
                                        endX={getXPosition(pkt.to)} 
                                    />
                                ))}
                                {visiblePackets.length === 0 && (
                                    <div className="mt-20 text-gray-300 font-bold uppercase tracking-widest animate-pulse text-center">
                                        Listo para capturar paquetes...
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                    
                    <div className="mt-8 max-w-3xl text-center">
                        <div className="inline-block px-4 py-1 bg-indigo-100 text-indigo-700 rounded-full text-[10px] font-bold uppercase tracking-widest mb-4">
                            Configuración de Red
                        </div>
                        <p className="text-xs text-gray-500 leading-relaxed italic">
                            Topología de bus lógico con el Servidor centralizado para mejor visualización de las tramas concurrentes.
                            El tráfico simula la captura original del archivo <span className="font-mono text-gray-800 font-bold">TCPencriptacion.pcapng</span>.
                        </p>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
